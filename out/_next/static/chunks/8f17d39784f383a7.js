(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,18566,(e,t,r)=>{t.exports=e.r(76562)},9165,e=>{"use strict";let t=new Map;async function r(e,t={},a=1e4,s=2){let l=new AbortController,i=setTimeout(()=>l.abort("request timeout"),a);try{let r=await fetch(e,{...t,signal:l.signal});return clearTimeout(i),r}catch(l){if(clearTimeout(i),s>0)return console.warn(`请求失败，正在重试 (剩余${s}次):`,l),r(e,t,a,s-1);throw l}}class a{maxConcurrent;queue;activeCount;constructor(e){this.maxConcurrent=e,this.queue=[],this.activeCount=0}async run(e){return new Promise((t,r)=>{let a=async()=>{this.activeCount++;try{let r=await e();t(r)}catch(e){r(e)}finally{this.activeCount--,this.next()}};this.activeCount<this.maxConcurrent?a():this.queue.push(a)})}next(){if(this.queue.length>0&&this.activeCount<this.maxConcurrent){let e=this.queue.shift();e&&e()}}}let s=new a(3),l=new a(5);function i(e){let t;if(!1===e.proxyEnabled)return;let r=(t=localStorage.getItem("proxySettings"))?JSON.parse(t):null;if(r?.enabled&&r?.proxyUrl)return r.proxyUrl}async function n(e,t,a=1){if(!e.apiUrl)throw Error("视频源API地址为空");let s=new URL("/api/proxy",window.location.origin);s.searchParams.set("apiUrl",e.apiUrl),s.searchParams.set("wd",t),s.searchParams.set("pg",a.toString());let l=i(e);l&&s.searchParams.set("proxyUrl",l);let o=await r(s.toString(),{method:"GET",headers:{"Content-Type":"application/json"}},e.timeout||1e4,e.retry||2);if(!o.ok)throw Error(`API请求失败: ${o.status}`);let c=await o.json();if(1===c.code)return{list:c.list.map(t=>({...t,sourceId:e.id,sourceName:e.name})),total:c.total};throw Error(c.msg||"搜索失败")}async function o(e,t,r=1){if(!e||0===e.length)throw Error("没有可用的视频源");let a=e.map(e=>l.run(()=>n(e,t,r).catch(t=>(console.error(`源 ${e.name} 搜索失败:`,t),{list:[],total:0})))),s=await Promise.all(a);return{list:s.flatMap(e=>e.list),total:s.reduce((e,t)=>e+t.total,0)}}function c(e,t,r,a,s=1){if(!e||0===e.length)return Promise.resolve([]);let i=!1;if(a){if(a.aborted)return Promise.reject(new DOMException("Aborted","AbortError"));a.addEventListener("abort",()=>{i=!0})}let o=new Set,d=Promise.all(e.map(e=>l.run(async()=>{if(i)return[];let a=[];try{a=(await n(e,t,s)).list}catch(t){if(i)return[];console.warn(`${e.name} 源搜索失败:`,t)}if(i)return[];let l=a.filter(e=>{let t=`${e.sourceId}_${e.vod_id}`;return!o.has(t)&&(o.add(t),!0)});return!i&&l.length>0&&r(l),l}))).then(e=>e.flat());return a?Promise.race([d,new Promise((e,t)=>{a.addEventListener("abort",()=>{t(new DOMException("Aborted","AbortError"))})})]):d}async function d(e,a){if(!e.apiUrl)throw Error("视频源API地址为空");let l=`${e.id}-${a}`,n=t.get(l);return n&&Date.now()-n.timestamp<3e5?n.data:s.run(async()=>{let s=new URL("/api/proxy",window.location.origin);s.searchParams.set("apiUrl",e.apiUrl),s.searchParams.set("ac","detail"),s.searchParams.set("ids",a.toString());let n=i(e);n&&s.searchParams.set("proxyUrl",n);let o=await r(s.toString(),{method:"GET",headers:{"Content-Type":"application/json"}},e.timeout||1e4,e.retry||2);if(!o.ok)throw Error(`API请求失败: ${o.status}`);let c=await o.json();if(1===c.code&&c.list&&c.list.length>0){let e=c.list[0];return t.set(l,{data:e,timestamp:Date.now()}),e}throw Error(c.msg||"获取视频详情失败")})}async function u(e,t){let r={};for(let a=0;a<e.length;a+=3){let s=e.slice(a,a+3);(await Promise.allSettled(s.map(async e=>{if(!e.sourceId||!e.vod_id)return null;let r=t.find(t=>t.id===e.sourceId);if(!r)return null;try{let t=await d(r,e.vod_id);return{vod_id:e.vod_id,vod_pic:t.vod_pic}}catch{return null}}))).forEach(e=>{"fulfilled"===e.status&&e.value&&e.value.vod_pic&&(r[e.value.vod_id]=e.value.vod_pic)}),a+3<e.length&&await new Promise(e=>setTimeout(e,200))}return r}function m(e){if(!e)return[];let t=[];return e.split("#").forEach((e,r)=>{let[a,s]=e.split("$");s&&t.push({label:a||`第${r+1}集`,url:s.replace(/\\/g,""),index:r})}),t}e.s(["aggregatedSearch",()=>c,"batchGetVideoCovers",()=>u,"buildProxyUrl",()=>i,"getVideoDetail",()=>d,"parsePlayUrl",()=>m,"searchVideosAll",()=>o])},3116,e=>{"use strict";let t=(0,e.i(75254).default)("clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 6v6l4 2",key:"mmk7yg"}]]);e.s(["Clock",()=>t],3116)},90454,e=>{"use strict";var t=e.i(43476),r=e.i(71645),a=e.i(18566),s=e.i(54346),l=e.i(31343),i=e.i(3116),n=e.i(93886),o=e.i(39616);let c=(0,e.i(75254).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);var d=e.i(22016),u=e.i(9165),m=e.i(56253);function h(){let e=(0,a.useSearchParams)(),h=(0,a.useRouter)(),x=e.get("q")||"",[f,g]=(0,r.useState)([]),[p,v]=(0,r.useState)(!1),[y,b]=(0,r.useState)(""),[w,j]=(0,r.useState)(0),[N,P]=(0,r.useState)(void 0),[S,C]=(0,r.useState)({}),E=(0,r.useRef)(null);(0,r.useEffect)(()=>{let e=localStorage.getItem("videoSources");e?P(JSON.parse(e).filter(e=>!1!==e.enabled)):P([])},[]);let _=(0,r.useCallback)(async(e,t)=>{if(!e.trim()){g([]),C({}),v(!1);return}if(0===t.length){b("请先在设置中配置并启用视频源"),v(!1);return}E.current?.abort();let r=new AbortController;E.current=r,v(!0),b(""),g([]),C({});try{let a=await (0,u.aggregatedSearch)(t,e,e=>{r.signal.aborted||(g(t=>{let r=[...t,...e];return j(r.length),r}),(0,u.batchGetVideoCovers)(e,t).then(e=>{r.signal.aborted||C(t=>({...t,...e}))}))},r.signal,1);if(!r.signal.aborted){g(a),j(a.length);let e=await (0,u.batchGetVideoCovers)(a,t);r.signal.aborted||C(e)}}catch(e){if("AbortError"===e.name)return void console.log("搜索已取消");console.error("搜索失败:",e),b(e instanceof Error?e.message:"搜索失败")}finally{v(!1)}},[]);return(0,r.useEffect)(()=>{if(void 0!==N)return _(x,N),()=>{E.current?.abort()}},[x,N,_]),(0,t.jsx)(m.default,{children:(0,t.jsxs)("div",{className:"min-h-screen relative",children:[(0,t.jsx)("div",{className:"absolute inset-0",style:{background:"linear-gradient(135deg, #1a1a2e, #16213e, #0f3460)",zIndex:0}}),(0,t.jsx)("div",{className:"absolute inset-0",style:{zIndex:1},children:(0,t.jsx)(s.default,{})}),(0,t.jsx)("div",{className:"relative",style:{zIndex:10},children:(0,t.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-20 sm:py-24",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row items-center justify-center sm:justify-between mb-8 gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("button",{onClick:()=>h.back(),className:"flex items-center gap-2 px-3 py-2 bg-gray-700/50 text-white rounded-lg hover:bg-gray-700/70 transition-colors",title:"返回",children:(0,t.jsx)(c,{className:"w-4 h-4"})}),(0,t.jsxs)("h1",{className:"text-2xl sm:text-3xl font-bold text-white",children:["搜索结果: ",(0,t.jsx)("span",{className:"text-blue-400",children:x})]})]}),(0,t.jsx)(d.default,{href:"/",className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition-colors",children:"返回首页"})]}),y&&(0,t.jsx)("div",{className:"max-w-2xl mx-auto mb-6 p-4 bg-red-500/20 border border-red-500/50 rounded-lg",children:(0,t.jsx)("p",{className:"text-red-400 text-center",children:y})}),p?(0,t.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,t.jsx)("div",{className:"w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),(0,t.jsx)("span",{className:"ml-3 text-gray-400",children:"搜索中..."})]}):0===f.length?(0,t.jsx)("div",{className:"text-center py-12 text-gray-400",children:"未找到相关视频"}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,t.jsxs)("p",{className:"text-gray-400",children:["共找到 ",(0,t.jsx)("span",{className:"text-white font-medium",children:w})," 条结果"]})}),(0,t.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4",children:f.map(e=>(0,t.jsxs)(d.default,{href:`/player?sourceId=${e.sourceId}&videoId=${e.vod_id}`,className:"bg-gray-800/50 backdrop-blur-sm rounded-xl overflow-hidden border border-gray-700/50 hover:border-blue-500/50 hover:scale-105 transition-all cursor-pointer group relative",children:[(0,t.jsx)("div",{className:"aspect-[3/4] bg-gray-700 overflow-hidden",children:S[e.vod_id]&&""!==S[e.vod_id].trim()?(0,t.jsx)("img",{src:S[e.vod_id],alt:e.vod_name,className:"w-full h-full object-cover group-hover:scale-110 transition-transform",onError:e=>{e.target.style.display="none"}}):(0,t.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-gray-600 to-gray-800",children:(0,t.jsx)(n.Film,{className:"w-16 h-16 text-gray-400"})})}),(0,t.jsxs)("div",{className:"p-3",children:[(0,t.jsx)("h3",{className:"text-white font-medium mb-2 text-sm line-clamp-2 group-hover:text-blue-400 transition-colors",children:e.vod_name}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs text-gray-400 mb-2",children:[(0,t.jsx)(n.Film,{className:"w-3 h-3"}),(0,t.jsx)("span",{className:"truncate",children:e.type_name})]}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-xs text-gray-400",children:[e.sourceName&&(0,t.jsxs)("span",{className:"flex items-center gap-1 text-blue-400 truncate",children:[(0,t.jsx)(o.Settings,{className:"w-3 h-3"}),e.sourceName]}),e.vod_remarks&&(0,t.jsxs)("span",{className:"flex items-center gap-1 text-blue-400 truncate",children:[(0,t.jsx)(i.Clock,{className:"w-3 h-3"}),e.vod_remarks]})]})]}),(0,t.jsx)("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:(0,t.jsx)(l.Play,{className:"w-12 h-12 text-white"})})]},e.vod_id))})]})]})})]})})}function x(){return(0,t.jsx)(r.Suspense,{fallback:null,children:(0,t.jsx)(h,{})})}e.s(["default",()=>x],90454)}]);