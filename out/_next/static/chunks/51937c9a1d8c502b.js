(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,37727,e=>{"use strict";let t=(0,e.i(75254).default)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);e.s(["X",()=>t],37727)},55436,e=>{"use strict";let t=(0,e.i(75254).default)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);e.s(["Search",()=>t],55436)},87316,e=>{"use strict";let t=(0,e.i(75254).default)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);e.s(["Calendar",()=>t],87316)},63059,e=>{"use strict";let t=(0,e.i(75254).default)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);e.s(["ChevronRight",()=>t],63059)},18566,(e,t,r)=>{t.exports=e.r(76562)},9165,e=>{"use strict";let t=new Map;async function r(e,t={},s=1e4,a=2){let l=new AbortController,i=setTimeout(()=>l.abort("request timeout"),s);try{let r=await fetch(e,{...t,signal:l.signal});return clearTimeout(i),r}catch(l){if(clearTimeout(i),a>0)return console.warn(`请求失败，正在重试 (剩余${a}次):`,l),r(e,t,s,a-1);throw l}}class s{maxConcurrent;queue;activeCount;constructor(e){this.maxConcurrent=e,this.queue=[],this.activeCount=0}async run(e){return new Promise((t,r)=>{let s=async()=>{this.activeCount++;try{let r=await e();t(r)}catch(e){r(e)}finally{this.activeCount--,this.next()}};this.activeCount<this.maxConcurrent?s():this.queue.push(s)})}next(){if(this.queue.length>0&&this.activeCount<this.maxConcurrent){let e=this.queue.shift();e&&e()}}}let a=new s(3),l=new s(5);function i(e){let t;if(!1===e.proxyEnabled)return;let r=(t=localStorage.getItem("proxySettings"))?JSON.parse(t):null;if(r?.enabled&&r?.proxyUrl)return r.proxyUrl}async function n(e,t,s=1){if(!e.apiUrl)throw Error("视频源API地址为空");let a=new URL("/api/proxy",window.location.origin);a.searchParams.set("apiUrl",e.apiUrl),a.searchParams.set("wd",t),a.searchParams.set("pg",s.toString());let l=i(e);l&&a.searchParams.set("proxyUrl",l);let o=await r(a.toString(),{method:"GET",headers:{"Content-Type":"application/json"}},e.timeout||1e4,e.retry||2);if(!o.ok)throw Error(`API请求失败: ${o.status}`);let c=await o.json();if(1===c.code)return{list:c.list.map(t=>({...t,sourceId:e.id,sourceName:e.name})),total:c.total};throw Error(c.msg||"搜索失败")}async function o(e,t,r=1){if(!e||0===e.length)throw Error("没有可用的视频源");let s=e.map(e=>l.run(()=>n(e,t,r).catch(t=>(console.error(`源 ${e.name} 搜索失败:`,t),{list:[],total:0})))),a=await Promise.all(s);return{list:a.flatMap(e=>e.list),total:a.reduce((e,t)=>e+t.total,0)}}function c(e,t,r,s,a=1){if(!e||0===e.length)return Promise.resolve([]);let i=!1;if(s){if(s.aborted)return Promise.reject(new DOMException("Aborted","AbortError"));s.addEventListener("abort",()=>{i=!0})}let o=new Set,d=Promise.all(e.map(e=>l.run(async()=>{if(i)return[];let s=[];try{s=(await n(e,t,a)).list}catch(t){if(i)return[];console.warn(`${e.name} 源搜索失败:`,t)}if(i)return[];let l=s.filter(e=>{let t=`${e.sourceId}_${e.vod_id}`;return!o.has(t)&&(o.add(t),!0)});return!i&&l.length>0&&r(l),l}))).then(e=>e.flat());return s?Promise.race([d,new Promise((e,t)=>{s.addEventListener("abort",()=>{t(new DOMException("Aborted","AbortError"))})})]):d}async function d(e,s){if(!e.apiUrl)throw Error("视频源API地址为空");let l=`${e.id}-${s}`,n=t.get(l);return n&&Date.now()-n.timestamp<3e5?n.data:a.run(async()=>{let a=new URL("/api/proxy",window.location.origin);a.searchParams.set("apiUrl",e.apiUrl),a.searchParams.set("ac","detail"),a.searchParams.set("ids",s.toString());let n=i(e);n&&a.searchParams.set("proxyUrl",n);let o=await r(a.toString(),{method:"GET",headers:{"Content-Type":"application/json"}},e.timeout||1e4,e.retry||2);if(!o.ok)throw Error(`API请求失败: ${o.status}`);let c=await o.json();if(1===c.code&&c.list&&c.list.length>0){let e=c.list[0];return t.set(l,{data:e,timestamp:Date.now()}),e}throw Error(c.msg||"获取视频详情失败")})}async function u(e,t){let r={};for(let s=0;s<e.length;s+=3){let a=e.slice(s,s+3);(await Promise.allSettled(a.map(async e=>{if(!e.sourceId||!e.vod_id)return null;let r=t.find(t=>t.id===e.sourceId);if(!r)return null;try{let t=await d(r,e.vod_id);return{vod_id:e.vod_id,vod_pic:t.vod_pic}}catch{return null}}))).forEach(e=>{"fulfilled"===e.status&&e.value&&e.value.vod_pic&&(r[e.value.vod_id]=e.value.vod_pic)}),s+3<e.length&&await new Promise(e=>setTimeout(e,200))}return r}function h(e){if(!e)return[];let t=[];return e.split("#").forEach((e,r)=>{let[s,a]=e.split("$");a&&t.push({label:s||`第${r+1}集`,url:a.replace(/\\/g,""),index:r})}),t}e.s(["aggregatedSearch",()=>c,"batchGetVideoCovers",()=>u,"buildProxyUrl",()=>i,"getVideoDetail",()=>d,"parsePlayUrl",()=>h,"searchVideosAll",()=>o])},3116,e=>{"use strict";let t=(0,e.i(75254).default)("clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 6v6l4 2",key:"mmk7yg"}]]);e.s(["Clock",()=>t],3116)},70273,e=>{"use strict";let t=(0,e.i(75254).default)("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);e.s(["Star",()=>t],70273)},23906,e=>{"use strict";var t=e.i(43476),r=e.i(71645),s=e.i(18566),a=e.i(63059),l=e.i(93886),i=e.i(3116),n=e.i(87316),o=e.i(70273),c=e.i(31343),d=e.i(55436),u=e.i(37727),h=e.i(22016),m=e.i(54346),x=e.i(56253),p=e.i(9165);function g(e){let t;if(!1===e.proxyEnabled)return;let r=(t=localStorage.getItem("proxySettings"))?JSON.parse(t):null;if(r?.enabled&&r?.proxyUrl)return r.proxyUrl}function f(){let e=(0,s.useRouter)(),f=(0,s.useSearchParams)(),[b,y]=(0,r.useState)([]),[w,v]=(0,r.useState)(null),[j,N]=(0,r.useState)([]),[k,S]=(0,r.useState)(null),[C,P]=(0,r.useState)([]),[U,_]=(0,r.useState)(!1),[E,I]=(0,r.useState)(""),[$,A]=(0,r.useState)(1),[T,M]=(0,r.useState)(0),[R,L]=(0,r.useState)(0),[q,G]=(0,r.useState)({}),[O,D]=(0,r.useState)(!1),[V,z]=(0,r.useState)(!1),[F,B]=(0,r.useState)(""),[J,K]=(0,r.useState)(!1),[X,W]=(0,r.useState)(!1),H=async e=>{if(e.apiUrl)try{let t=new URL("/api/proxy",window.location.origin);t.searchParams.set("apiUrl",e.apiUrl),t.searchParams.set("ac","list");let r=g(e);r&&t.searchParams.set("proxyUrl",r);let s=await fetch(t.toString(),{method:"GET",headers:{"Content-Type":"application/json"}});if(!s.ok)return;let a=await s.json();1===a.code&&a.class&&a.class.length>0&&N(a.class)}catch(e){console.error("加载分类失败:",e)}},Q=async(e,t=1,r=null,s=null)=>{if(!e.apiUrl)return void I("视频源API地址为空");_(!0),I(""),G({});try{let a=new URL("/api/proxy",window.location.origin);a.searchParams.set("apiUrl",e.apiUrl),a.searchParams.set("pg",t.toString()),s?a.searchParams.set("wd",s):r&&a.searchParams.set("t",r.toString());let l=g(e);l&&a.searchParams.set("proxyUrl",l);let i=await fetch(a.toString(),{method:"GET",headers:{"Content-Type":"application/json"}});if(!i.ok)throw Error(`API请求失败: ${i.status}`);let n=await i.json();if(1===n.code){let t=n.list.map(t=>({...t,sourceId:e.id}));if(P(t),M(n.pagecount),L(n.total),t.length>0){let r=await (0,p.batchGetVideoCovers)(t,[e]);G(r)}}else I(n.msg||"获取视频列表失败")}catch(e){console.error("加载视频列表失败:",e),I(e instanceof Error?e.message:"加载视频列表失败")}finally{_(!1)}},Y=e=>{w&&(S(e),K(!1),B(""),A(1),Q(w,1,e),et(w.id,e,1))},Z=e=>{w&&(A(e),Q(w,e,k),et(w.id,k,e))},ee=async()=>{if(F.trim()){K(!0),S(null),A(1),_(!0),I(""),G({});try{if(X){let e=await (0,p.searchVideosAll)(b,F.trim(),1);if(P(e.list),L(e.total),M(1),e.list.length>0){let t=await (0,p.batchGetVideoCovers)(e.list,b);G(t)}}else w&&(Q(w,1,null,F.trim()),et(w.id,null,1))}catch(e){I(e instanceof Error?e.message:"搜索失败")}finally{_(!1)}}},et=(t,r,s)=>{let a=new URLSearchParams;a.set("sourceId",t),null!==r&&a.set("category",r.toString()),a.set("page",s.toString()),e.push(`/api-videos?${a.toString()}`,{scroll:!1})};return(0,r.useEffect)(()=>{let e=localStorage.getItem("videoSources");if(e){let t=JSON.parse(e).filter(e=>!1!==e.enabled&&"tvbox"!==e.type);y(t);let r=f.get("sourceId"),s=f.get("category"),a=f.get("page");if(r){let e=t.find(e=>e.id===r);if(e){v(e);let t=s?parseInt(s):null,r=a?parseInt(a):1;S(t),A(r),H(e),Q(e,r,t)}else t.length>0&&(v(t[0]),H(t[0]),Q(t[0],1,null))}else t.length>0&&(v(t[0]),H(t[0]),Q(t[0],1,null))}D(!0)},[]),(0,t.jsx)(x.default,{children:(0,t.jsxs)("div",{className:"min-h-screen relative",children:[(0,t.jsx)("div",{className:"absolute inset-0",style:{background:"linear-gradient(135deg, #1a1a2e, #16213e, #0f3460)",zIndex:0}}),(0,t.jsx)("div",{className:"absolute inset-0",style:{zIndex:1},children:(0,t.jsx)(m.default,{})}),(0,t.jsx)("div",{className:"relative",style:{zIndex:10},children:(0,t.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-20 sm:py-24",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row items-center justify-center sm:justify-between mb-8 gap-4",children:[(0,t.jsx)("h1",{className:"text-3xl sm:text-4xl font-bold text-white",children:"API视频"}),(0,t.jsxs)(h.default,{href:"/",className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition-colors",children:[(0,t.jsx)(a.ChevronRight,{className:"w-5 h-5 rotate-180"}),"返回首页"]})]}),0===b.length?(0,t.jsx)("div",{className:"bg-gray-800/50 backdrop-blur-sm rounded-xl p-12 border border-gray-700/50",children:(0,t.jsx)("p",{className:"text-gray-400 text-center",children:"暂无已启用的视频源，请先在设置中配置并启用视频源"})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"bg-gray-800/50 backdrop-blur-sm rounded-xl p-3 sm:p-4 border border-gray-700/50 mb-6",children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,t.jsx)("h2",{className:"text-base sm:text-lg font-semibold text-white",children:"选择视频源"})}),(0,t.jsx)("div",{className:"grid grid-cols-3 sm:flex sm:flex-wrap gap-2",children:b.map(e=>(0,t.jsx)("button",{onClick:()=>{v(e),S(null),A(1),H(e),Q(e,1,null),et(e.id,null,1)},className:`w-full sm:w-24 h-10 rounded-full border transition-all text-sm font-medium flex items-center justify-center ${w?.id===e.id?"bg-blue-500/20 border-blue-400 text-white":"bg-white/5 border-white/10 text-gray-300 hover:bg-white/10 hover:border-white/20"}`,children:e.name},e.id))})]}),w&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"mb-6",children:(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row items-center gap-3",children:[(0,t.jsxs)("div",{className:"flex-1 w-full relative",children:[(0,t.jsx)("input",{type:"text",value:F,onChange:e=>B(e.target.value),onKeyDown:e=>"Enter"===e.key&&ee(),placeholder:"搜索视频...",className:"w-full px-4 py-3 sm:px-6 sm:py-4 pl-10 sm:pl-12 pr-12 sm:pr-14 text-sm sm:text-lg bg-gray-800/80 backdrop-blur-sm text-white placeholder-gray-400 border border-gray-700 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"}),(0,t.jsx)("svg",{className:"absolute left-3 sm:left-4 top-1/2 -translate-y-1/2 w-4 h-4 sm:w-5 sm:h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),(0,t.jsx)("button",{onClick:ee,className:"absolute right-2 sm:right-3 top-1/2 -translate-y-1/2 p-1.5 sm:p-2 bg-blue-600 hover:bg-blue-700 text-white rounded-full transition-colors",title:"搜索",children:(0,t.jsx)(d.Search,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 w-full sm:w-auto justify-center",children:[J&&(0,t.jsx)("button",{onClick:()=>{B(""),K(!1),w&&(A(1),Q(w,1,k),et(w.id,k,1))},className:"px-4 py-2.5 bg-gray-600 hover:bg-gray-700 text-white rounded-full transition-colors",children:(0,t.jsx)(u.X,{className:"w-4 h-4"})}),(0,t.jsxs)("div",{className:"flex items-center gap-2 px-4 py-2.5 bg-gray-700/50 border border-gray-600/50 rounded-full",children:[(0,t.jsx)("span",{className:"text-sm text-gray-300",children:"聚合搜索"}),(0,t.jsx)("button",{onClick:()=>W(!X),className:`relative inline-flex h-5 w-9 items-center rounded-full transition-colors ${X?"bg-blue-600":"bg-gray-600"}`,children:(0,t.jsx)("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${X?"translate-x-5":"translate-x-0.5"}`})})]})]})]})}),!J&&j.length>0&&(0,t.jsxs)("div",{className:"bg-gray-800/50 backdrop-blur-sm rounded-xl p-4 sm:p-6 border border-gray-700/50 mb-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)("h2",{className:"text-lg sm:text-xl font-semibold text-white",children:"分类筛选"}),j.length>8&&(0,t.jsx)("button",{onClick:()=>z(!V),className:"text-sm text-blue-400 hover:text-blue-300 transition-colors",children:V?"收起":"展开"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-3 sm:flex sm:flex-wrap gap-2",children:[(0,t.jsx)("button",{onClick:()=>Y(null),className:`w-full sm:w-24 h-10 rounded-full border transition-all text-sm font-medium flex items-center justify-center ${null===k&&!J?"bg-blue-500/20 border-blue-400 text-white":"bg-white/5 border-white/10 text-gray-300 hover:bg-white/10 hover:border-white/20"}`,children:"全部"}),(V?j:j.slice(0,8)).map(e=>(0,t.jsx)("button",{onClick:()=>Y(e.type_id),className:`w-full sm:w-24 h-10 rounded-full border transition-all text-sm font-medium flex items-center justify-center ${k===e.type_id?"bg-blue-500/20 border-blue-400 text-white":"bg-white/5 border-white/10 text-gray-300 hover:bg-white/10 hover:border-white/20"}`,children:e.type_name},e.type_id))]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsxs)("p",{className:"text-gray-400",children:["共找到 ",(0,t.jsx)("span",{className:"text-white font-medium",children:R})," 个视频"]}),!J&&(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsxs)("span",{className:"text-gray-400 text-sm",children:["第 ",$," / ",T," 页"]})})]}),U?(0,t.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,t.jsx)("div",{className:"w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),(0,t.jsx)("span",{className:"ml-3 text-gray-400",children:"加载中..."})]}):E?(0,t.jsx)("div",{className:"bg-gray-800/50 backdrop-blur-sm rounded-xl p-6 border border-red-500/50",children:(0,t.jsx)("p",{className:"text-red-400 text-center",children:E})}):0===C.length?(0,t.jsx)("div",{className:"text-center py-12 text-gray-400",children:J?"未找到相关视频":"该视频源暂无视频"}):(0,t.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4",children:C.map(e=>(0,t.jsxs)(h.default,{href:`/player?sourceId=${e.sourceId||w?.id}&videoId=${e.vod_id}&returnUrl=${encodeURIComponent(`/api-videos?${f.toString()}`)}`,className:"bg-white/5 backdrop-blur-md rounded-xl overflow-hidden border border-white/10 hover:border-white/20 hover:bg-white/10 transition-all cursor-pointer group relative shadow-lg",children:[(0,t.jsx)("div",{className:"aspect-[3/4] bg-gray-700 overflow-hidden",children:q[e.vod_id]&&""!==q[e.vod_id].trim()?(0,t.jsx)("img",{src:q[e.vod_id],alt:e.vod_name,className:"w-full h-full object-cover group-hover:scale-110 transition-transform",onError:e=>{e.target.style.display="none"}}):(0,t.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-gray-600 to-gray-800",children:(0,t.jsx)(l.Film,{className:"w-16 h-16 text-gray-400"})})}),(0,t.jsxs)("div",{className:"p-3",children:[(0,t.jsx)("h3",{className:"text-white font-medium mb-2 text-sm line-clamp-2 group-hover:text-blue-400 transition-colors",children:e.vod_name}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs text-gray-400 mb-2",children:[(0,t.jsx)(l.Film,{className:"w-3 h-3"}),(0,t.jsx)("span",{className:"truncate",children:e.type_name})]}),e.sourceName&&(0,t.jsx)("div",{className:"flex items-center gap-1 text-xs text-blue-400 mb-2",children:(0,t.jsx)("span",{className:"truncate",children:e.sourceName})}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-xs text-gray-400",children:[e.vod_area&&(0,t.jsx)("span",{className:"flex items-center gap-1 text-blue-400 truncate",children:(0,t.jsx)("span",{children:e.vod_area})}),e.vod_year&&(0,t.jsxs)("span",{className:"flex items-center gap-1 text-blue-400 truncate",children:[(0,t.jsx)(n.Calendar,{className:"w-3 h-3"}),e.vod_year]}),e.vod_score&&(0,t.jsxs)("span",{className:"flex items-center gap-1 text-yellow-400 truncate",children:[(0,t.jsx)(o.Star,{className:"w-3 h-3"}),e.vod_score]}),e.vod_remarks&&(0,t.jsxs)("span",{className:"flex items-center gap-1 text-blue-400 truncate",children:[(0,t.jsx)(i.Clock,{className:"w-3 h-3"}),e.vod_remarks]})]})]}),(0,t.jsx)("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:(0,t.jsx)(c.Play,{className:"w-12 h-12 text-white"})})]},`${e.sourceId}-${e.vod_id}`))}),T>1&&!J&&(0,t.jsxs)("div",{className:"flex items-center justify-center gap-2 mt-8",children:[(0,t.jsx)("button",{onClick:()=>Z(Math.max(1,$-1)),disabled:1===$,className:"p-2 bg-white/5 text-gray-300 rounded-lg hover:bg-white/10 disabled:opacity-50 disabled:cursor-not-allowed transition-colors border border-white/10",children:(0,t.jsx)(a.ChevronRight,{className:"w-4 h-4 rotate-180"})}),(0,t.jsxs)("span",{className:"text-gray-300 text-sm",children:["第 ",$," / ",T," 页"]}),(0,t.jsx)("button",{onClick:()=>Z(Math.min(T,$+1)),disabled:$===T,className:"p-2 bg-white/5 text-gray-300 rounded-lg hover:bg-white/10 disabled:opacity-50 disabled:cursor-not-allowed transition-colors border border-white/10",children:(0,t.jsx)(a.ChevronRight,{className:"w-4 h-4"})})]})]})]})]})})]})})}function b(){return(0,t.jsx)(r.Suspense,{fallback:(0,t.jsx)("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:(0,t.jsx)("div",{className:"text-white",children:"加载中..."})}),children:(0,t.jsx)(f,{})})}e.s(["default",()=>b])}]);